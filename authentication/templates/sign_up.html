{% extends "base.html" %} {% block content %}

{% load i18n %}

<div class="grid grid-cols-1 lg:grid-cols-2">
  <div class="flex flex-col items-start justify-start px-8">
    <div class="my-10 flex flex-col items-center lg:items-start justify-center w-full">
      <h2 class="text-secondary font-bold text-4xl">{% trans 'Inscription' %}</h2>
      {% csrf_token %}
      <div class="mt-10">
        <h2 class="font-bold">Type de compte:</h2>
        <div class="flex flex-row flex-wrap space-x-5">
          <div class="mt-5 flex flex-row items-center space-x-2">
            <label for="" class="font-medium">Entreprise</label>
            <input type="radio" name="account_type" class="" v-model="accountType" value="1" />
          </div>
          <div class="mt-5 flex flex-row items-center space-x-2">
            <label for="" class="font-medium">École</label>
            <input type="radio" name="account_type" class="" v-model="accountType" value="2" />
          </div>
          <div class="mt-5 flex flex-row items-center space-x-2">
            <label for="" class="font-medium">Étudiant</label>
            <input type="radio" name="account_type" class="" v-model="accountType" value="3" />
          </div>
        </div>
      </div>
      <Transition name="fade">
        <div class="grid grid-cols-1 lg:grid-cols-2 mt-10 gap-8 w-full" v-if="accountType==3">
          <div class="flex flex-col col-span-2 lg:col-span-1">
            <label for="" class="font-bold mb-2 hover">Nom:</label>
            <input type="text" class="rounded-md py-3 px-4 shadow-lg border-2 border-black hover:border-black"
              placeholder="John" :class="{'border-red-500': errors.first_name.length}" @focus="errors.first_name=[]"
              v-model="loginForm.first_name" />
            <div v-if="errors.first_name.length">
              <span class="text-red-500 text-xs italic" v-for="error in errors.first_name" :key="error">
                [[ error ]]</span>
            </div>
          </div>
          <div class="flex flex-col col-span-2 lg:col-span-1">
            <label for="" class="font-bold mb-2 hover">Prénom:</label>
            <input type="text" class="py-3 px-4 rounded-md shadow-lg border-2 border-black hover:border-black"
              placeholder="Doe" :class="{'border-red-500': errors.last_name.length}" @focus="errors.last_name=[]"
              v-model="loginForm.last_name" />
            <div v-if="errors.last_name.length">
              <span class="text-red-500 text-xs italic" v-for="error in errors.last_name" :key="error">
                [[ error ]]</span>
            </div>
          </div>
          <div class="flex flex-col col-span-2">
            <label for="" class="font-bold mb-2 hover">Email:</label>
            <input type="email" class="py-3 px-4 rounded-md shadow-lg border-2 border-black hover:border-black"
              placeholder="johndoe@xxxx.xx" :class="{'border-red-500': errors.email.length}" @focus="errors.email=[]"
              v-model="loginForm.email" />
            <div v-if="errors.email.length">
              <span class="text-red-500 text-xs italic" v-for="error in errors.email" :key="error">
                [[ error ]]</span>
            </div>
          </div>
          <div class="flex flex-col col-span-2">
            <label for="" class="font-bold mb-2 hover">Mot de passe:</label>
            <input type="password" class="py-3 px-4 rounded-md shadow-lg border-2 border-black hover:border-black"
              placeholder="•••••••••" :class="{'border-red-500': errors.password.length}" @focus="errors.password=[]"
              v-model="loginForm.password" />
            <div v-if="errors.password.length">
              <span class="text-red-500 text-xs italic" v-for="error in errors.password" :key="error">
                [[ error ]]</span>
            </div>
          </div>
          <div class="flex flex-col col-span-2">
            <label for="" class="font-bold mb-2 hover">Confirmation mot de passe:</label>
            <input type="password" class="py-3 px-4 rounded-md shadow-lg border-2 border-black hover:border-black"
              placeholder="•••••••••" :class="{'border-red-500':
              errors.confirmPassword.length}" v-model="loginForm.confirmPassword" @focus="errors.confirmPassword=[]" />
            <div v-if="errors.confirmPassword.length">
              <span class="text-red-500 text-xs italic" v-for="error in errors.confirmPassword" :key="error">
                [[ error ]]</span>
            </div>
          </div>
        </div>
      </Transition>

      <div class="mt-10 flex justify-center w-full">
        <button @click="handleLoginForm"
          class="text-white text-sm font-bold bg-secondary py-2 px-8 w-48 h-14 rounded-full hover:bg-primary flex justify-center items-center cursor-pointer">
          {% trans 'Inscription' %}
        </button>
      </div>
    </div>
  </div>
  <div class="hidden lg:block">
    <div class="bg-blue-500 h-screen flex flex-col justify-center items-center px-10" style="
        background-image: url('/static/img/authbackground.png');
        background-repeat: no-repeat;
        background-size: cover;
      ">
      <div class="">
        <h2 class="font-bold text-3xl text-white mb-5"> {% trans 'HelpNeed' %}</h2>
        <p class="text-white">
          {% trans 'HelpNeedMessage' %}
        </p>
      </div>
    </div>
  </div>
</div>



{% include './components/footer.html' %} {% endblock %}

{% block vueJs %}
<script>
  const app = Vue.createApp({
    delimiters: ["[[", "]]"],
    data() {
      return {
        accountType: '3',
        loginForm: {
          first_name: '',
          last_name: '',
          email: '',
          password: '',
          confirmPassword: '',
        },
        errors: {
          first_name: [],
          last_name: [],
          email: [],
          password: [],
          confirmPassword: [],
        },
      }
    },
    methods: {
      async handleLoginForm() {
        this.errors = {
          first_name: [],
          last_name: [],
          email: [],
          password: [],
          confirmPassword: [],
        }

        if (!this.loginForm.first_name) {
          this.errors.first_name.push('Veuillez entrer votre nom')
        }
        if (!this.loginForm.last_name) {
          this.errors.last_name.push('Veuillez entrer votre prénom')
        }
        if (!this.loginForm.email) {
          this.errors.email.push('Veuillez entrer votre email')
        }
        if (!this.loginForm.password) {
          this.errors.password.push('Veuillez entrer votre mot de passe')
        }
        if (!this.loginForm.confirmPassword) {
          this.errors.confirmPassword.push('Veuillez confirmer votre mot de passe')
        }
        if (this.loginForm.password !== this.loginForm.confirmPassword) {
          this.errors.confirmPassword.push('Les mots de passe ne correspondent pas')
        }

        if (Object.entries(this.errors).some(([key, val]) => val.length > 0)) return

        const response = await fetch('/auth/sign-up/', {
          method: 'POST',
          headers: {
            "X-CSRFToken": getCookie("csrftoken"),
          },
          body: JSON.stringify({
            ...this.loginForm,
            accountType: this.accountType
          }),
        })


        if (response.status === 200) {
          window.location.href = '/auth/sign-in/'
        } else {
          const data = await response.json()
          this.errors = Object.entries(data).reduce((acc, [key, val]) => {
            return {
              ...acc,
              [key]: val
            }
          }, this.errors)
        }
      }
    },
  }).mount('#app')
</script>

<style>
  .fade-enter-active,
  .fade-leave-active {
    transition: opacity 0.5s ease;
  }

  .fade-enter-from,
  .fade-leave-to {
    opacity: 0;
  }
</style>
{% endblock %}